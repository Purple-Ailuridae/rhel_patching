"Host Name","IP Address","OS Version","Workflow Path","Status","Critical Issues Count","Warning Issues Count","CPU Usage","Memory Usage","Disk Usage","Critical Issues","Last Updated"
{% for host in need_fix_list %}
"{{ host }}","{{ hostvars[host].get('ansible_host', 'Unknown') }}","{{ hostvars[host].get('ansible_distribution', 'Unknown') }} {{ hostvars[host].get('ansible_distribution_version', 'Unknown') }}","{% if host in (reboot_success_list | default([])) %}Complete_Success{% elif host in (revert_success_list | default([])) %}Reverted_After_Failure{% elif host in (patch_success_list | default([])) %}Patched_No_Reboot{% elif host in (not_snapshot_list | default([])) %}No_Snapshot_Created{% elif host in (patch_failed_list | default([])) or host in (reboot_failed_list | default([])) %}Failed_Operations{% else %}Unknown_Path{% endif %}","{{ 'Healthy' if host in (healthy_list | default([])) else 'Needs_Fix' }}","{{ hostvars[host].get('health_profile', {}).get('health_issues', []) | selectattr('severity', 'equalto', 'critical') | list | length }}","{{ hostvars[host].get('health_profile', {}).get('health_issues', []) | selectattr('severity', 'equalto', 'warning') | list | length }}","{% if hostvars[host].get('health_profile', {}).get('cpu_usage', -1) >= 0 %}{{ hostvars[host].health_profile.cpu_usage }}%{% else %}Unknown{% endif %}","{% if hostvars[host].get('health_profile', {}).get('memory_usage', -1) >= 0 %}{{ hostvars[host].health_profile.memory_usage }}%{% else %}Unknown{% endif %}","{% if hostvars[host].get('health_profile', {}).get('disk_usage', -1) >= 0 %}{{ hostvars[host].health_profile.disk_usage }}%{% else %}Unknown{% endif %}","{{ hostvars[host].get('health_profile', {}).get('health_issues', []) | selectattr('severity', 'equalto', 'critical') | map(attribute='issue') | join('; ') | replace('"', '""') }}","{{ ansible_date_time.iso8601 }}"
{% endfor %}